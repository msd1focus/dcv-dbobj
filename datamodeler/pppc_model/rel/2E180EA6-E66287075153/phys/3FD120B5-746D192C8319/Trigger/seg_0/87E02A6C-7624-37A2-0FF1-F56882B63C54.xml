<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="FCS_UPDATE_END_DATE_UPD" directorySegmentName="seg_0" id="87E02A6C-7624-37A2-0FF1-F56882B63C54">
<sourceConnName>pppc@uatfdi</sourceConnName>
<sourceObjSchema>FOCUSPP</sourceObjSchema>
<sourceObjName>FCS_UPDATE_END_DATE_UPD</sourceObjName>
<createdBy>frans</createdBy>
<createdTime>2019-04-30 09:54:21 UTC</createdTime>
<ownerDesignName>pppc_model</ownerDesignName>
<actions>UPDATE</actions>
<body>DECLARE&lt;br/&gt;    PRAGMA AUTONOMOUS_TRANSACTION;&lt;br/&gt;BEGIN&lt;br/&gt;    -- CREATED BY   : MII - SODIQ MR.&lt;br/&gt;    -- CREATE DATE  : 13-APR-2018&lt;br/&gt;    -- REASON       : DIGUNAKAN UNTUK UPDATE END DATE KETIKA ADDENDUM DI CANCEL&lt;br/&gt;&lt;br/&gt;    IF :OLD.ADDENDUM_KE IS NOT NULL AND :NEW.STATUS = &apos;CANCELED&apos; AND :OLD.DISCOUNT_TYPE &lt;&gt; &apos;BIAYA&apos; THEN&lt;br/&gt;        &lt;br/&gt;        UPDATE FOCUSPP.PROPOSAL PC&lt;br/&gt;        SET PC.PERIODE_PROG_TO = (&lt;br/&gt;                                    SELECT PC3.PP_PROG_TO_ORI&lt;br/&gt;                                    FROM FOCUSPP.PROPOSAL PC3&lt;br/&gt;                                    WHERE PC3.CONFIRM_NO = :OLD.CONFIRM_NO&lt;br/&gt;                                    AND NVL(PC3.ADDENDUM_KE,0) = &lt;br/&gt;                                    (&lt;br/&gt;                                        SELECT MAX(NVL(PC2.ADDENDUM_KE,0))&lt;br/&gt;                                        FROM FOCUSPP.PROPOSAL PC2&lt;br/&gt;                                        WHERE PC2.CONFIRM_NO = :OLD.CONFIRM_NO&lt;br/&gt;                                        AND PC2.STATUS = &apos;ACTIVE&apos;&lt;br/&gt;                                        AND NVL(PC2.ADDENDUM_KE,0) &lt; :OLD.ADDENDUM_KE&lt;br/&gt;                                    )&lt;br/&gt;                                 )&lt;br/&gt;            , PC.PROG_DAYS = (&lt;br/&gt;                                SELECT (PC3.PP_PROG_TO_ORI - PC3.PP_PROG_FROM_ORI)+1&lt;br/&gt;                                FROM FOCUSPP.PROPOSAL PC3&lt;br/&gt;                                WHERE PC3.CONFIRM_NO = :OLD.CONFIRM_NO&lt;br/&gt;                                AND NVL(PC3.ADDENDUM_KE,0) = &lt;br/&gt;                                (&lt;br/&gt;                                    SELECT MAX(NVL(PC2.ADDENDUM_KE,0))&lt;br/&gt;                                    FROM FOCUSPP.PROPOSAL PC2&lt;br/&gt;                                    WHERE PC2.CONFIRM_NO = :OLD.CONFIRM_NO&lt;br/&gt;                                    AND PC2.STATUS = &apos;ACTIVE&apos;&lt;br/&gt;                                    AND NVL(PC2.ADDENDUM_KE,0) &lt; :OLD.ADDENDUM_KE&lt;br/&gt;                                )&lt;br/&gt;                             )&lt;br/&gt;        WHERE PC.CONFIRM_NO = :OLD.CONFIRM_NO&lt;br/&gt;        AND NVL(PC.ADDENDUM_KE,0) =&lt;br/&gt;        (&lt;br/&gt;            SELECT MAX(NVL(PC1.ADDENDUM_KE,0))&lt;br/&gt;            FROM FOCUSPP.PROPOSAL PC1&lt;br/&gt;            WHERE PC1.CONFIRM_NO = :OLD.CONFIRM_NO&lt;br/&gt;            AND PC1.STATUS = &apos;ACTIVE&apos;&lt;br/&gt;            AND NVL(PC1.ADDENDUM_KE,0) &lt; :OLD.ADDENDUM_KE&lt;br/&gt;        );&lt;br/&gt;        &lt;br/&gt;        COMMIT;&lt;br/&gt;        &lt;br/&gt;    END IF;&lt;br/&gt;    &lt;br/&gt;    IF NVL(:NEW.ADDENDUM_KE,&apos;0&apos;) &gt; NVL(:OLD.ADDENDUM_KE,&apos;0&apos;) AND NVL(:NEW.ADDENDUM_KE,&apos;0&apos;) &gt; 0 AND :NEW.STATUS = &apos;ACTIVE&apos; AND :OLD.DISCOUNT_TYPE &lt;&gt; &apos;BIAYA&apos; THEN&lt;br/&gt;    &lt;br/&gt;        UPDATE FOCUSPP.PROPOSAL PC&lt;br/&gt;        SET PC.PERIODE_PROG_TO = :NEW.PERIODE_PROG_FROM-1&lt;br/&gt;          , PC.PROG_DAYS = (:NEW.PERIODE_PROG_FROM - PC.PERIODE_PROG_FROM)&lt;br/&gt;        WHERE PC.CONFIRM_NO = :NEW.CONFIRM_NO&lt;br/&gt;        AND NVL(PC.ADDENDUM_KE,0) =&lt;br/&gt;        (&lt;br/&gt;            SELECT MAX(NVL(PC1.ADDENDUM_KE,0))&lt;br/&gt;            FROM FOCUSPP.PROPOSAL PC1&lt;br/&gt;            WHERE PC1.CONFIRM_NO = :NEW.CONFIRM_NO&lt;br/&gt;            AND PC1.STATUS = &apos;ACTIVE&apos;&lt;br/&gt;            AND NVL(PC1.ADDENDUM_KE,0) &lt; :NEW.ADDENDUM_KE&lt;br/&gt;        );&lt;br/&gt;        &lt;br/&gt;        COMMIT;&lt;br/&gt;        &lt;br/&gt;    END IF;&lt;br/&gt;    &lt;br/&gt;    IF NVL(:NEW.ADDENDUM_KE,&apos;0&apos;) &gt; NVL(:OLD.ADDENDUM_KE,&apos;0&apos;) AND NVL(:NEW.ADDENDUM_KE,&apos;0&apos;) &gt; 0 AND :NEW.STATUS = &apos;ACTIVE&apos; AND :OLD.DISCOUNT_TYPE = &apos;BIAYA&apos; THEN&lt;br/&gt;        UPDATE FOCUSPP.PROPOSAL PC&lt;br/&gt;        SET STATUS = &apos;CANCELED&apos;&lt;br/&gt;        WHERE PC.CONFIRM_NO = :NEW.CONFIRM_NO&lt;br/&gt;        AND NVL(PC.ADDENDUM_KE,0) =&lt;br/&gt;        (&lt;br/&gt;            SELECT MAX(NVL(PC1.ADDENDUM_KE,0))&lt;br/&gt;            FROM FOCUSPP.PROPOSAL PC1&lt;br/&gt;            WHERE PC1.CONFIRM_NO = :NEW.CONFIRM_NO&lt;br/&gt;            AND PC1.STATUS = &apos;ACTIVE&apos;&lt;br/&gt;            AND NVL(PC1.ADDENDUM_KE,0) &lt; :NEW.ADDENDUM_KE&lt;br/&gt;        );&lt;br/&gt;        &lt;br/&gt;        COMMIT;&lt;br/&gt;        &lt;br/&gt;    END IF;&lt;br/&gt;    &lt;br/&gt;    &lt;br/&gt;END; </body>
<triggerTime>AFTER</triggerTime>
<owner>C0E782E6-EB7A-0CBE-800D-2B771EA4EA91</owner>
<table>0B58EC0D-9337-649B-BDE3-46DA8B7829C0</table>
</TriggerOraclev10g>